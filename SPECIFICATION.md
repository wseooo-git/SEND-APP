# SEND - 기획 및 기능 명세서

## 1. 개요

### 1.1 프로젝트 소개

**SEND**는 클라이밍 파티/대회에서 실시간으로 점수를 관리하고 팀 경쟁을 진행할 수 있는 웹 애플리케이션입니다.

- **앱 이름**: SEND (클라이밍 용어로 "완등하다"의 의미)
- **목적**: 클라이밍 동호회/크루의 파티 및 대회 점수 관리
- **플랫폼**: 모바일 웹 (반응형)
- **배포 방식**: 각 크루가 독립적으로 배포하여 사용 (Firebase + Vercel)

### 1.2 기술 스택

| 분류 | 기술 |
|------|------|
| Frontend | React 18, Vite |
| Styling | Tailwind CSS |
| Database | Firebase Realtime Database |
| Hosting | Vercel |
| Font | Pretendard, Outfit |

---

## 2. 사용자 역할

### 2.1 파티 생성자 (관리자)

"파티 만들기"를 누른 사람이 해당 파티의 관리자가 됩니다.

- 파티 생성 및 설정
- 참가자 등록/승인
- 팀장 지정
- 팀 배정 (드래그앤드롭, 같은 팀 묶기)
- 게임 시작

### 2.2 참가자

파티 코드로 참여하는 일반 사용자입니다.

- 참가 신청 (관리자 승인 필요)
- 본인 점수 입력
- 현황판 확인

---

## 3. 사용자 흐름

### 3.1 관리자 흐름

```
홈 → 파티 만들기 → 기본 정보 입력 → 난이도 설정 → 게임 규칙 설정
→ 파티 코드 생성 → 참가자 등록/승인 → 팀 배정 → 게임 시작 → 현황 확인
```

### 3.2 참가자 흐름

```
홈 → 파티 참여하기 → 코드 입력 → 참가 신청 (승인 대기)
→ 게임 시작 후 → 이름 선택 → 점수 입력 → 현황 확인
```

---

## 4. 화면별 기능 명세

### 4.1 홈 화면

| 요소 | 설명 |
|------|------|
| 로고 | "SEND" 텍스트 로고 (Outfit 폰트) |
| 서브타이틀 | "클라이밍 파티 점수 관리" |
| 파티 만들기 버튼 | 검정 배경, 파티 생성 화면으로 이동 |
| 파티 참여하기 버튼 | 흰색 배경, 코드 입력 화면으로 이동 |
| 최근 파티 목록 | 최근 참여/생성한 파티 최대 5개 표시 (localStorage) |

#### 최근 파티 기능
- 파티 생성/참여 시 자동 저장
- 관리자로 접속한 파티는 관리자 코드도 함께 저장
- 클릭 시 바로 입장 (관리자 권한 자동 복원)
- 삭제된 파티는 목록에서 자동 제거

### 4.2 파티 생성 (3단계)

#### Step 1: 기본 정보
- 파티 이름 (필수)
- 장소 (필수)
- 날짜 (기본값: 오늘)

#### Step 2: 난이도 설정
- 프리셋 선택 (8개 클라이밍장) 또는 커스텀
- **프리셋 선택 후에도 편집 가능**
- 각 난이도별: 이름, 색상, 기본 점수 설정
- 각 난이도 클릭 시 색상 팔레트 표시 (14색)
- 난이도 추가/수정/삭제 가능
- 최소 2개 이상 필요

#### Step 3: 게임 규칙
- 팀 수: 2~4팀 선택
- 최대 집계 문제 수: 5~20개 (슬라이더, 기본 10개)
- 점수 배율: 도전/적정/기본 각각 설정 가능

### 4.3 파티 참여

- 6자리 코드 입력 (영문+숫자)
- 자동 대문자 변환
- 유효하지 않은 코드 시 에러 메시지 표시

### 4.4 로비

#### 공통 기능
- 파티 코드 대형 표시
- 참가자 목록 (난이도별 색상 표시)

#### 관리자 전용
- 관리자 코드 표시
- 참가자 직접 등록
- 참가 신청 승인/거절
- 팀장 지정 (★ 표시)
- 참가자 삭제
- "팀 배정하기" 버튼

#### 참가자 전용
- 참가 신청 (승인 대기)
- "게임 참여하기" 버튼 (게임 시작 후)

### 4.5 팀 배정 (관리자)

#### 영역 구성
- **미배정 영역**: 아직 팀이 없는 참가자 표시
- **팀 영역**: 팀별 멤버 표시 (2~4개)

#### 기능
- **드래그 앤 드롭**: 참가자 카드를 팀으로 이동
- **같은 팀 묶기**: 두 명 클릭 → 연결선 표시 → 항상 같은 팀 배정 (팀장은 불가)
- **자동 배정**: 아래 로직에 따라 균형 있게 배정
- **배정 완료**: 게임 상태로 전환

#### 자동 배정 로직
1. **팀장 분리**: 팀장들을 각 팀에 1명씩 배정 (팀장끼리 같은 팀 불가)
2. **연결된 짝 배정**: 같은 팀으로 묶인 참가자 우선 배정
3. **레벨별 균등 분배**: 같은 레벨 참가자를 각 팀에 균등하게 나눔
4. **인원 균형**: 팀별 인원 수가 최대한 같아지도록 배정

### 4.6 게임 (점수 입력)

#### 이름 선택 화면
- 난이도별 그룹으로 참가자 목록
- 팀 색상 테두리로 구분
- 팀장 ★ 표시

#### 점수 입력 화면
- 상단: 이름, 난이도, 팀, 현재 총점
- 프로그레스 바: n/10 (최대 집계 개수 표시)
- 완등 추가 버튼: 집계 가능한 난이도만 표시
  - 도전 (+1단계): 배율 표시
  - 적정 (본인 레벨): 배율 표시
  - 기본 (-1단계): 배율 표시
- 완등 기록 목록
  - 난이도 색상, 점수 표시
  - 삭제 버튼
  - 미집계 문제: 회색 처리 + "(미집계)" 표시

### 4.7 현황판

- **팀별 총점 카드**: 리드하는 팀 강조 (색상 반전)
- **점수 격차**: 실시간 차이 표시
- **개인 순위 목록**
  - 1위: 금색 메달
  - 2위: 은색 메달
  - 3위: 동색 메달
  - 팀 색상 배경
  - 점수, 완등 개수 표시

---

## 5. 점수 시스템

### 5.1 기본 점수

난이도별로 기본 점수 설정 (프리셋 또는 커스텀)

예시 (담장):
| 난이도 | 기본 점수 |
|--------|----------|
| 검정 | 150 |
| 흰색 | 100 |
| 보라 | 70 |
| 남색 | 60 |
| 파랑 | 40 |

### 5.2 배율 시스템

| 구분 | 조건 | 기본 배율 |
|------|------|----------|
| 도전 | 본인 레벨보다 1단계 위 | ×1.5 |
| 적정 | 본인 레벨 | ×1.0 |
| 기본 | 본인 레벨보다 1단계 아래 | ×0.5 |

### 5.3 집계 규칙

- 본인 난이도 ±1 범위만 집계 가능
- **상위 N개 점수만 합산** (기본 10개, 설정 가능)
- 초과분은 기록되지만 점수에 미포함 (회색 표시)
- 점수 높은 순으로 자동 정렬하여 집계

### 5.4 점수 계산 예시

보라 난이도 참가자가:
- 흰색 완등 → 100 × 1.5 = **150점** (도전)
- 보라 완등 → 70 × 1.0 = **70점** (적정)
- 남색 완등 → 60 × 0.5 = **30점** (기본)
- 검정/파랑 → **집계 불가** (범위 초과)

---

## 6. 데이터 구조

### 6.1 Firebase 스키마

```javascript
parties/{partyCode}: {
  // 기본 정보
  name: string,           // 파티 이름
  venue: string,          // 장소
  date: string,           // 날짜 (YYYY-MM-DD)
  code: string,           // 6자리 파티 코드
  adminCode: string,      // 6자리 관리자 코드
  status: 'waiting' | 'playing',
  createdAt: string,      // ISO timestamp
  
  // 난이도 설정
  presetKey: string,      // 프리셋 ID 또는 'custom'
  levels: [
    { 
      id: string,         // 고유 ID
      name: string,       // 난이도 이름
      color: string,      // HEX 색상
      baseScore: number   // 기본 점수
    }
  ],
  
  // 게임 설정
  settings: {
    multipliers: { 
      challenge: number,  // 도전 배율 (기본 1.5)
      normal: number,     // 적정 배율 (기본 1.0)
      easy: number        // 기본 배율 (기본 0.5)
    },
    range: number,        // 집계 범위 (기본 1)
    maxProblems: number   // 최대 집계 문제 수 (기본 10)
  },
  teamCount: number,      // 팀 수 (2~4)
  
  // 팀 정보
  teams: {
    team1: { 
      name: string,       // 팀 이름 (레드, 블루 등)
      color: string,      // 메인 색상
      bg: string,         // 배경 색상
      members: []         // 멤버 이름 배열
    },
    team2: { ... },
    // team3, team4 (선택)
  },
  
  // 참가자 정보
  participants: {
    [name]: {
      level: string,      // 난이도 ID
      team: string | null,// 팀 키 (team1, team2 등)
      isLeader: boolean,  // 팀장 여부
      scores: [
        { 
          level: string,  // 완등한 난이도 ID
          score: number,  // 획득 점수
          time: string    // ISO timestamp
        }
      ],
      approved: boolean   // 승인 여부
    }
  },
  
  // 연결된 짝 (같은 팀 묶기)
  linkedPairs: [
    [name1, name2],
    ...
  ]
}
```

---

## 7. 클라이밍장 프리셋

| 프리셋 ID | 이름 | 난이도 수 | 난이도 구성 |
|-----------|------|----------|------------|
| damjang | 담장 | 5 | 검정, 흰색, 보라, 남색, 파랑 |
| theclimb | 더클라임 | 6 | 검정, 빨강, 주황, 노랑, 초록, 파랑 |
| climbingpark | 클라이밍파크 | 5 | 검정, 빨강, 파랑, 초록, 노랑 |
| seoulforest | 서울숲클라이밍 | 5 | 검정, 핑크, 보라, 초록, 파랑 |
| stones | 스톤즈 | 5 | 검정, 흰색, 빨강, 파랑, 초록 |
| seoulboulders | 서울볼더스 | 5 | 검정, 빨강, 주황, 노랑, 초록 |
| theplastic | 더플라스틱 | 5 | 검정, 보라, 빨강, 파랑, 초록 |
| sonsangwon | 손상원클라이밍 | 5 | 검정, 빨강, 주황, 노랑, 흰색 |

---

## 8. 디자인 시스템

### 8.1 컬러 팔레트

| 용도 | 색상 코드 |
|------|----------|
| 배경 | #FAFAFA |
| 카드 배경 | #FFFFFF |
| 텍스트 (주) | #111111 |
| 텍스트 (보조) | #666666 |
| 보더 | #E5E5E5 |
| 강조/버튼 | #000000 |
| 비활성화 | #CCCCCC |

### 8.2 팀 컬러

| 팀 | 이름 | 메인 색상 | 배경 색상 |
|----|------|----------|----------|
| team1 | 레드 | #EF4444 | #FEF2F2 |
| team2 | 블루 | #3B82F6 | #EFF6FF |
| team3 | 그린 | #22C55E | #F0FDF4 |
| team4 | 오렌지 | #F97316 | #FFF7ED |

### 8.3 타이포그래피

| 용도 | 폰트 |
|------|------|
| Display (로고, 점수, 코드) | Outfit |
| Body (본문, UI) | Pretendard |

### 8.4 디자인 원칙

- **미니멀**: 불필요한 장식 최소화
- **흑백 베이스**: 팀 컬러만 포인트로 사용
- **이모지 최소화**: ★ (팀장) 정도만 사용
- **넉넉한 여백**: 답답하지 않은 레이아웃
- **모바일 우선**: 터치 친화적 UI

---

## 9. 파일 구조

```
SEND-APP/
├── index.html              # HTML 진입점
├── package.json            # 의존성 관리
├── vite.config.js          # Vite 설정
├── tailwind.config.js      # Tailwind 설정
├── postcss.config.js       # PostCSS 설정
├── .env.example            # 환경변수 예시
├── README.md               # 사용 설명서
├── SPECIFICATION.md        # 기능 명세서 (이 문서)
└── src/
    ├── main.jsx            # React 진입점
    ├── App.jsx             # 메인 앱 컴포넌트 (모든 뷰 포함)
    ├── index.css           # 글로벌 스타일
    ├── firebase.js         # Firebase 설정
    └── data/
        └── presets.js      # 클라이밍장 프리셋 데이터
```

---

## 10. 배포 구조

### 10.1 독립 배포 방식

각 클라이밍 크루가 자체적으로 배포하여 사용합니다.

```
[GitHub 저장소] → Fork → [각 크루 저장소]
                              ↓
                        [각 크루 Firebase]
                              ↓
                        [각 크루 Vercel 앱]
```

### 10.2 장점

- 데이터 완전 분리 (크루 간 간섭 없음)
- 비용 분산 (각 크루가 무료 티어 사용)
- 독립적 운영 (커스터마이징 가능)

---

## 11. 향후 개선 사항

- [ ] PWA 지원 (오프라인, 홈 화면 추가)
- [ ] 푸시 알림 (점수 업데이트)
- [ ] 파티 히스토리 저장 및 통계
- [ ] 타이머/시간 제한 모드
- [ ] 다국어 지원
- [ ] 관리자 여러 명 지정
- [ ] 파티 템플릿 저장 기능
